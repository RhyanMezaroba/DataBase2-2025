@model TransporteAereo.Models.Compra
@using TransporteAereo.Models

@{
    ViewData["Title"] = "Confirmação de Compra";
    Layout = "_Layout";
}

<section class="min-h-screen py-20 bg-black text-white">
    <div class="max-w-6xl mx-auto px-6 sm:px-10 lg:px-12">

        <div class="bg-yellow-900/40 border border-yellow-600 text-yellow-300 px-8 py-8 rounded-xl mb-10 text-center shadow-lg shadow-yellow-500/20">
            <h1 class="text-4xl font-extrabold mb-2">Atenção: Pagamento Pendente!</h1>
            <p class="text-lg">
                Sua transação está <strong>@Model.Status</strong>. Clique abaixo para finalizar o pagamento e confirmar sua reserva.
            </p>
        </div>

        <h2 class="text-3xl font-bold text-blue-400 mb-6 border-b border-gray-800 pb-3">Detalhes da Compra</h2>

        <div class="grid md:grid-cols-3 gap-6 mb-12">
            <div class="bg-gray-900 p-6 rounded-xl shadow-lg border border-gray-800">
                <p class="text-sm font-semibold text-gray-400">Viagem</p>
                <p class="text-xl font-mono text-blue-300">@Model.Viagem.NomeViagem</p>
            </div>
            <div class="bg-gray-900 p-6 rounded-xl shadow-lg border border-gray-800">
                <p class="text-sm font-semibold text-gray-400">Data da Compra</p>
                <p class="text-xl text-white">@Model.DataCompra.ToString("dd/MM/yyyy HH:mm")</p>
            </div>
            <div class="bg-gray-900 p-6 rounded-xl shadow-lg border border-gray-800">
                <p class="text-sm font-semibold text-gray-400">Valor Total</p>
                <p class="text-3xl font-extrabold text-green-400">@Model.PrecoTotal.ToString("C")</p>
            </div>
        </div>

        <h3 class="text-2xl font-bold text-amber-400 mb-6">Trechos & Assentos</h3>

        @foreach (var r in Model.Reservas.OrderBy(r => r.VooPoltrona?.Voo?.HorarioSaida))
        {
            var vooPoltrona = r.VooPoltrona;
            if (vooPoltrona == null)
            {
                <div class="bg-red-900 text-white p-4 mb-4 rounded-xl">
                    ⚠️ Alerta: Reserva (ID: @r.Id) possui VooPoltrona ausente. Entre em contato com o suporte.
                </div>
                continue;
            }

            var voo = vooPoltrona.Voo;
            var poltrona = vooPoltrona.Assento;

            if (voo == null)
            {
                <div class="bg-red-900 text-white p-4 mb-4 rounded-xl">
                    ⚠️ Alerta: Reserva (ID: @r.Id) possui Voo corrompido ou ausente.
                </div>
                continue;
            }

            <div class="bg-gray-900 border border-gray-800 p-6 rounded-xl shadow-lg shadow-amber-500/10 mb-6">

                <div class="flex justify-between items-start">
                    <h4 class="text-lg font-semibold text-white">
                        ✈️ @voo.AeroportoOrigem?.NomeAeroporto → @voo.AeroportoDestino?.NomeAeroporto
                    </h4>

                    <span class="bg-purple-600 text-white text-sm px-3 py-1 rounded-full font-bold">
                        Assento @poltrona.NumeroAssento
                    </span>
                </div>

                <div class="grid md:grid-cols-2 gap-y-3 text-gray-300 text-sm mt-4">
                    <p><strong>ID Reserva:</strong> @r.Id</p>
                    <p><strong>Status:</strong> <span class="text-yellow-400 font-bold">@r.Status</span></p>
                    <p><strong>Partida:</strong> @voo.HorarioSaida.ToString("dd/MM/yyyy HH:mm")</p>
                    <p><strong>Chegada:</strong> @voo.HorarioChegada.ToString("dd/MM/yyyy HH:mm")</p>
                    <p><strong>Aeronave:</strong> @voo.Aeronave?.Modelo</p>
                    <p><strong>Localização:</strong> @poltrona.Localizacao</p>
                </div>

            </div>
        }

        @if (Model.Status == StatusCompra.Pendente)
        {
            <div class="mt-8 pt-5 text-center border-t border-gray-800">
                <p class="text-gray-400 mb-4">
                    Confirme o pagamento de <strong class="text-green-400">@Model.PrecoTotal.ToString("C")</strong> para emitir sua passagem.
                </p>
                <form asp-action="ProcessarPagamento" method="post">
                    <input type="hidden" name="idCompra" value="@Model.Id" />
                    <button type="submit"
                            class="bg-green-600 hover:bg-green-700 px-8 py-3 rounded-lg text-xl font-bold text-white transition shadow-lg shadow-green-500/30">
                        💳 Finalizar Pagamento e Emitir Passagem
                    </button>
                </form>
            </div>
        }
        else
        {
            <div class="mt-8 pt-5 text-center border-t border-gray-800">
                <p class="text-gray-400 mb-4">
                    Sua transação está <strong class="text-green-400">Concluída</strong>. Você pode baixar sua passagem ou procurar novas viagens.
                </p>
                <a asp-action="DownloadRecibo" asp-route-id="@Model.Id"
                   class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg text-lg font-bold text-white transition shadow-lg shadow-blue-500/20 mr-4">
                    ⬇️ Baixar Passagem PDF
                </a>
                <a asp-action="Index"
                   class="bg-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg text-lg font-bold text-white transition">
                    🔎 Procurar Novas Viagens
                </a>
            </div>
        }
    </div>
</section>