@model TransporteAereo.Models.Viagem
@using TransporteAereo.Models

@{
    ViewData["Title"] = "Detalhes da Viagem";
    Layout = "_Layout";
}

<section class="min-h-screen py-20 bg-black text-white">
    <div class="max-w-7xl mx-auto px-6 sm:px-10 lg:px-12">

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="bg-green-900/40 border border-green-600 text-green-300 px-4 py-3 rounded-lg mb-4 shadow-lg shadow-green-500/20">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="bg-red-900/40 border border-red-600 text-red-300 px-4 py-3 rounded-lg mb-4 shadow-lg shadow-red-500/20">
                @TempData["ErrorMessage"]
            </div>
        }

        <h1 class="text-4xl md:text-5xl font-extrabold mb-3">
            ✈️ Detalhes da <span class="text-blue-400">Viagem</span>
        </h1>
        <p class="text-gray-400 mb-8 border-b border-gray-800 pb-4">
            Escolha <strong class="text-white">múltiplos assentos</strong> para a compra.
        </p>

        <div class="bg-gray-900 rounded-xl border border-gray-800 shadow-xl shadow-blue-500/10 p-8 mb-10">

            <h2 class="text-2xl font-bold text-blue-400 mb-4">
                @Model.NomeViagem <span class="text-gray-400">(@Model.Voos.Count() Trecho(s))</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-300 text-lg">
                <p><span class="text-blue-400 font-semibold">Origem:</span> @Model.AeroportoOrigem.NomeAeroporto</p>
                <p><span class="text-blue-400 font-semibold">Destino:</span> @Model.AeroportoDestino.NomeAeroporto</p>
                <p><span class="text-blue-400 font-semibold">Partida:</span> @Model.DataPartida.ToString("dd/MM/yyyy")</p>
                <p><span class="text-blue-400 font-semibold">Chegada:</span> @Model.DataChegada.ToString("dd/MM/yyyy")</p>
            </div>

            <p class="mt-6 text-3xl font-extrabold text-green-400">
                Preço Base (por assento): @Model.PrecoTotal.ToString("C")
            </p>
        </div>

        <form asp-action="Comprar" method="post">

            @foreach (var voo in Model.Voos.OrderBy(v => v.HorarioSaida))
            {
                <div class="bg-gray-900 rounded-xl border border-gray-800 shadow-lg shadow-amber-500/10 p-8 mb-10">

                    <h3 class="text-2xl font-bold text-amber-400 mb-3">
                        ✈️ Voo @(Model.Voos.ToList().IndexOf(voo) + 1):
                        <span class="text-blue-400">@voo.AeroportoOrigem.NomeAeroporto</span> →
                        <span class="text-blue-400">@voo.AeroportoDestino.NomeAeroporto</span>
                    </h3>

                    <p class="text-gray-400 mb-4">
                        <span class="text-gray-300 font-medium">Partida:</span> @voo.HorarioSaida.ToString("dd/MM/yyyy HH:mm") |
                        <span class="text-gray-300 font-medium">Chegada:</span> @voo.HorarioChegada.ToString("dd/MM/yyyy HH:mm") |
                        <span class="text-gray-300 font-medium">Aeronave:</span> @voo.Aeronave?.Modelo
                    </p>

                    @if (voo.Escalas != null && voo.Escalas.Any())
                    {
                        <h4 class="text-lg font-bold text-yellow-300 mt-6 mb-3 border-t border-gray-700 pt-4">
                            Paradas (Escalas)
                        </h4>
                        <ul class="list-disc list-inside space-y-2 ml-4 mb-4">
                            @foreach (var escala in voo.Escalas.OrderBy(e => e.HorarioChegada))
                            {
                                <li class="text-gray-400 text-base">
                                    <span class="font-semibold text-yellow-400">@escala.AeroportoEscala.NomeAeroporto</span>:
                                    Chegada <span class="text-white">@escala.HorarioChegada.ToString("dd/MM/yyyy HH:mm")</span> |
                                    Saída <span class="text-white">@escala.HorarioSaida.ToString("dd/MM/yyyy HH:mm")</span>
                                </li>
                            }
                        </ul>
                    }

                    <p class="text-sm text-gray-400 mb-6">
                        Acréscimos: <span class="text-white font-semibold">Executiva (+R$100), Primeira (+R$200)</span>
                    </p>

                    <div class="grid grid-cols-6 md:grid-cols-10 gap-2 p-4 bg-gray-800 rounded-lg">

                        @foreach (var assento in voo.Aeronave.Assentos.OrderBy(a => a.NumeroAssento))
                        {
                            var vooPoltrona = voo.VooPoltronas.FirstOrDefault(vp => vp.IdPoltrona == assento.Id);
                            bool isIndisponivel =
                            vooPoltrona != null &&
                            (vooPoltrona.Status == StatusPoltrona.Reservado ||
                            vooPoltrona.Status == StatusPoltrona.Ocupado ||
                            vooPoltrona.Status == StatusPoltrona.Indisponível);

                            string statusClass = isIndisponivel
                            ? "bg-red-900 border-red-700 text-gray-500 cursor-not-allowed opacity-50"
                            : "bg-green-700 hover:bg-green-600 text-white cursor-pointer shadow-green-500/30 shadow-lg";

                            string classeCor = assento.Classe switch
                            {
                                ClasseAssento.Executiva => "text-yellow-400",
                                ClasseAssento.Primeira => "text-red-400",
                                _ => "text-white",
                            };

                            <label class="flex flex-col justify-center items-center h-16 w-14 rounded-md border border-gray-600 text-xs font-bold transition-transform duration-200 hover:scale-110 @statusClass">

                                <input type="checkbox"
                                       name="assentoIds"
                                       value="@assento.Id"
                                @(isIndisponivel ? "disabled" : "")
                                       class="hidden" />

                                <span class="@classeCor">@assento.NumeroAssento</span>
                                <span class="text-xs font-light text-gray-300">@assento.Classe</span>
                            </label>
                        }
                    </div>
                </div>
            }

            <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1 text-lg">
                ✅ Reservar Assentos e Continuar
            </button>
        </form>
    </div>
</section>

<style>
    label:has(input[type="checkbox"]:checked) {
        border-color: #FCD34D;
        background-color: #A855F7; 
        box-shadow: 0 0 12px rgba(252, 211, 77, 0.8);
        transform: scale(1.12);
        z-index: 10;
    }
</style>